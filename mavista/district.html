<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>MA Vista District Reports</title>

    <!-- Scripts -->

    <script src="assets/js/d3.v4.min.js"></script>
    <script src="assets/js/charts.js"></script>

    <!-- Stylesheets -->

    <link rel="stylesheet" type="text/css" href="assets/css/main.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="assets/css/print.css" media="print" />

    <!-- Fonts -->

    <link href='https://fonts.googleapis.com/css?family=Arimo' rel='stylesheet'>
    <link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>
    <link href='https://fonts.googleapis.com/css?family=Raleway' rel='stylesheet'>

  </head>

  <body class="content">

    <section id="selectors">
      <select id="district_selector">
      </select>
    </section>

    <section id="demographics">
      <h1>Demographic Questions</h1>
      <p>
        The first section fo the survey includes questions about survey respondents' experience in an administrative role and about their schools. Responses from this section may be used to understand how to target resources and supports based on school profiles.
      </p>
      <div id="i1"></div>
    </section>

    <section id="social_emotional">
      <h1>Social and Emotional Learning</h1>
      <div id="d3"></div>
    </section>

  </body>

  <!-- Charts -->

  <script>
    d3.csv("assets/data/district_data.csv", function(error, data) {
      if (error) { console.log(error); }
      else {
        data.forEach(function(d) {
          d.WeightedCntEstimate = +d.WeightedCntEstimate;
          d.WeightedCntSTDError = +d.WeightedCntSTDError;
          d.WeightedCntCILowerBound = +d.WeightedCntCILowerBound;
          d.WeightedCntCIUpperBound = +d.WeightedCntCIUpperBound;
          d.WeightedPctEstimate = +d.WeightedPctEstimate;
          d.WeightedPctSTDError = +d.WeightedPctSTDError;
          d.WeightedPctCILowerBound = +d.WeightedPctCILowerBound;
          d.WeightedPctCIUpperBound = +d.WeightedPctCIUpperBound;
          d.WeightedMean = +d.WeightedMean;
          d.WeightedMeanSE = +d.WeightedMeanSE;
          d.WeightedMeanCILowerBound = +d.WeightedMeanCILowerBound;
          d.WeightedMeanCIUpperBound = +d.WeightedMeanCIUpperBound;
          d.WeightedMedian = +d.WeightedMedian;
        });

        /* District dropdown */

        d3.select("#district_selector")
          .selectAll("option")
          .data(d3.map(data, function(d) { return d.District; }).keys())
          .enter()
            .append("option")
              .text(function(d) { return d; })
              .attr("value", function(d) { return d; });

        /* Filter data */

        function filterData() {

          data_i1 = data.filter(function(d) { return d.Chart == "i1" && d.ResponseCategory == "Yes" /*&& d.District == d3.select("#district_selector").property("value")*/; });
          data_d3 = data.filter(function(d) { return d.Chart == "D3" && d.ResponseCategory == "Yes" /*&& d.District == d3.select("#district_selector").property("value")*/; });

        };

        filterData();

        /* Charts */

        function drawCharts() {

          var chart_i1 = bar_yes_no().data(data_i1).chart_id("i1").marginLeft(365);
          var chart_d3 = bar_yes_no().data(data_d3).chart_id("d3").marginLeft(400);

          d3.select("#i1").call(chart_i1);
          d3.select("#d3").call(chart_d3);

        };

        drawCharts();

        /* Upon change, re-filter and re-draw */

        d3.select("#district_selector")
          .on("change", function() {

            d3.selectAll("svg")
              .transition()
                .duration(1000)
                .style("opacity", 0)
                .on("end", function() {

                  d3.selectAll("svg").remove();
                  filterData();
                  drawCharts();

                });
          });

      };
    });
  </script>

</html>
