<!-- DOCTYPE HTML-->
<meta charset="utf-8">
<head>
	<title>Findings from the 2013-14 Survey on the Use of Funds Under Title II, Part A</title>
	
	<!-- scripts -->
	
	<script src="assets/js/jquery.min.js"></script>
	<script src="assets/js/main.js"></script>	
	<script src="https://d3js.org/d3.v4.min.js"></script>
	
	<!-- stylesheets -->
	
	<link rel="stylesheet" type="text/css" href="assets/css/main.css">
	
</head>
<body>
	<section id="navigation">
		<div>
			<nav>
				<ul>
					<li class="title">Findings from the 2013-14 Survey on the Use of Funds Under Title II, Part A</li>
					<li><a href="#about">About the survey</a></li>
					<li><a href="#distribution">Distribution of funds</a></li>
					<li><a href="#useoffunds">Use of funds</a></li>
					<li><a href="#profdev">Professional development</a></li>
					<li class="icon"><a href="javascript:void(0);" onclick="menu()">&#9776;</a></li>
				</ul>
			</nav>
		</div>
	</section>
	<div class="wrapper">
		<section id="about">
			<div>
				<p>
					<span class="header">Findings from the 2013-14 Survey on the Use of Funds Under Title II, Part A</span>
				</p>
				<hr style="height: 1px; border: none; background-color: #333;">
				<p>
					<strong>About the survey:</strong> To gather information on how school districts use Title II, Part A funds in order to develop national estimates on how Title II, Part A funds are used. The survey also collects data on types and topics of professional development offered by school districts in the previous school year.
				</p>
				<p>
					<strong>Sample:</strong> A nationally-representative sample of 800 school districts selected based on district poverty levels and enrollment.
				</p>
				<p>
					<strong>Response rate:</strong> In 2013-14, 81 percent of school districts responded to the survey.
				</p>
				<hr style="height: 1px; border: none; background-color: #333;">
			</div>
		</section>
		<section id="distribution">
		</section>
		<section id="useoffunds">
		<div id="pd_subjects" class="chart"></div>
		</section>		
		<section id="profdev">
		</section>
	</div>
</body>

<!-- Charts -->

<script>

	// PD waffle charts
	
	d3.tsv("assets/data/data.tsv", function(error, data) {
		if (error) { console.log(error); }
		else {
			data.forEach(function(d) {
				d.order = +d.order;
				d.percent = +d.percent;
			});
					
		// margins, width, height, dataset
		
		var width,
			height,
			widthSquares = 10, // number of squares wide
			heightSquares = 10, // number of squares tall
			squareSize = 16, // size of squares in pixels
			gap = 1, // size of gap between squares
			waffleData = []; 			
	
		width = (squareSize*widthSquares) + (widthSquares*gap) + squareSize;
		height = (squareSize*heightSquares) + (heightSquares*gap) + squareSize;

		// colors by subject
		
		var color = d3.scaleOrdinal()
		  .domain(["English/Language Arts", "Mathematics", "Science", "Technology", "History/Social Studies", "Fine Arts", "Special Education", "ESOL", "Foreign Languages", "Other"])
		  .range(["#E56C0A", "#5DBF7E", "#2E8A95", "#215F8A", "#1C276E", "#FAC190", "#C8E9D2", "#8ED1E0", "#76B4DE", "#98A2E7"]);
		  
		// format data for use in waffles
	
		data.forEach(function(d, i) {
			d.units = d.percent;
			waffleData = waffleData.concat(
				Array(d.units+1).join(1).split("").map(function() {
					return {
						subject: d.subject,
						use_type: d.use_type,
						squareValue: 1,
						units: d.units,
						groupIndex: i
					};
				})
			);
		});	

		// nest data for multiples
		
		var subjects = d3.nest()
			.key(function(d) { return d.subject; })
			.entries(waffleData);	
	
		// build the charts

		var waffleDiv = d3.select("#pd_subjects")
			.selectAll("div")
			.data(subjects)
			.each()
				.enter()
					.append("div")
						.attr("width", width)
						.style("display", "inline-block");
		
		var waffleSVG = waffleDiv.append("div")
			.append("svg")
				.attr("width", width)
				.attr("height", height)
				.append("g");
		
		var waffle = waffleSVG.selectAll("rect")
			.data(subjects);
			
		waffle.each()
			.data(function(d) { return d.values; })
			.enter()
				.append("rect")
					.attr("width", squareSize)
					.attr("height", squareSize)
					.attr("x", function(d, i) {
						
						// group number of squares for columns
						
						col = i%heightSquares;
						return (col*squareSize) + (col*gap) + (squareSize/2);
						
					})
					.attr("y", function(d, i) {
					
						row = Math.floor(i/heightSquares);
						return (heightSquares*squareSize) - ((row*squareSize) + (row*gap) - 1);
					
					})
					.style("opacity", 0)
					.style("fill", function(d) {
						if (d.use_type == "For") { return color(d.subject) }
						else { return "#F1F2F1"}
					})
					.transition()
						.ease(d3.easeQuadInOut)
						.delay(function(d, i) { return i*25; })
						.duration(0)
						.style("opacity", 100);

		var waffleText = waffleDiv.append("div")
			.attr("width", width);
	
		var waffleCounter = waffleText.selectAll("text.waffleCounter")
			.data(subjects);
			
		waffleCounter.each()
			.data(function(d) { return d.values; })
			.enter()
				.filter(function(d, i) { return d.use_type == "For" && i === 0; })
				.append("text")
					.text("0")
					.style("color", function(d) { return color(d.subject) })
					.attr("class", "waffleCounter");
	
		var format = d3.format(".0%");	
	
		waffleText.selectAll("text")
			.transition()
			.duration(function(d) { return 25*d.units; })
			.tween("text", function(d) {
			
				var that = d3.select(this),
					i = d3.interpolateNumber(that.text(), d.units/100);
					
				return function(t) { that.text(format(i(t))); };
				
			});
	
		var waffleSubject = waffleText.selectAll("p.waffleSubject")
			.data(subjects);
		
		waffleSubject.each()
			.data(function(d) { return d.values; })
			.enter()
				.filter(function(d, i) { return i === 0; })
				.append("p")
					.text(function(d) { return d.subject; })
					.attr("class", "waffleSubject");
	
/*		var waffleCounter = waffleText.selectAll("text")
			.data(subjects);
		
		waffleCounter.each()
			.data(function(d) { return d.values; })
			.enter()
				.append("text")
					.text(0)
					.transition()
						.duration(1000)
						.tween("text", function(d) { 
						
							var i = d3.interpolate(0, d.percent);
						return function(t) { d3.select(this).text(i(t)); };
						
					});*/
		
		};
	});
	
</script>

</html>