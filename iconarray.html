<!DOCTYPE html>
<html>

<head>
	<meta charset = "UTF-8">
	<title>InformED Chronic Absenteeism D3 Icon Array Example</title>
	<link rel = "stylesheet" href = "styles.css">
</head>

<!-- JS scripts -->

<script src = "https://d3js.org/d3.v3.min.js"></script>
<script src = "https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.6.7/d3-tip.js"></script>

<style>

	/* Import fonts */

	@import url("https://fonts.googleapis.com/css?family=Inconsolata:100,400,500,700");
	@import url("https://fonts.googleapis.com/css?family=Muli:300,400");
	@import url("https://fonts.googleapis.com/css?family=Karla:400,700");

	/* Styling for legend */
	
	.legend {
		font: 400 12px Inconsolata;
		color: white;
	}
	
	/* Styling for the count section */
	
	.count {
		font: 400 60px Inconsolata;
		fill: white;
	}
	
	.countText {
		font: normal 16px Muli;
		fill: white;	
	}
	
	/* Icon array styling */

	.icon {
		stroke: white;
	}
	
	/* Equivalencies styling */
	
	.equiv {
		font: 400 60px Inconsolata;
		fill: white;
	}
	
	.equivText {
		font: normal 16px Muli;
		fill: white;	
	}
	
</style>

<body bgcolor = "#000">
<p class = "txt-medium" align = "center"><font color = "white">DUMMY DATA</font><br/><hr></p>
<p>&nbsp;</p>
<div id = "viz"></div>

<script>

// margins and dimensions

var margin = {top: 20, right: 20, bottom: 20, left: 20},
	width = 960 - margin.left - margin.right,
	height = 500 - margin.top - margin.bottom;
	
// formats
	
var	formatNumber = d3.format(",f"),
	formatPercent = d3.format(",.1%");
	
// read in data and build array

d3.tsv("Data/data_iconarray.tsv", function(error, data) {
	if (error) { console.log(error); }
	else {
		data.forEach(function(d) {
			d.icon_count = +d.icon_count; // This is the subgroup
			d.number = +d.number; // This is the percentage
		});
	};

	var rowCount = 10;
	var iconWidth = 50;
	var iconHeight = 50;
	var legendWidth = 25;
	var legendHeight = 25;
	
	var dom = d3.select("#viz")
		.append("div")
			.attr("id", "iconArray")
			.style({
				"max-width": width + "px",
				"margin": "20px auto 20px auto",
				"text-align": "center"
			});
	
	// first, put in legend
	
	var legendIcon = dom.append("div")
		.attr("id", "legendIcon")
		.attr("class", "legend")
		.style({
			"display": "inline-block",
			"vertical-align": "middle",
			"height": legendHeight + "px"
		});	
	
	d3.xml("Images/chair.svg", "image/svg+xml", function(error, xml) {  
	
		if (error) throw error;
		
		legendIcon.node().appendChild(xml.documentElement);
		
		legendIcon.selectAll("svg")
			.attr("height", legendWidth + "px")
			.attr("width", legendHeight + "px");
		
		legendIcon.selectAll("#Woodchair")
			.attr("class", "icon");
		
	});
	
	var legendText = dom.append("div")
		.attr("id", "legendText")
		.attr("class", "legend")
		.style({
			"display": "inline-block",
			"vertical-align": "middle"
		})
		.html("<span>= 100,000 students</span>");
	
	dom.append("p");

	// next, put in count of chronically absent students
	
	data_txt = data.filter(function(d) { return d.area == "txt"; });
	
	var count = dom.append("div")
		.data(data_txt)
		.attr("id", "countSection")
		.style({
			"width": "100%",
			"max-width": width + "px",
			"margin": "0 auto",
			"display": "block"
		})
		.append("svg")
			.attr("viewBox", "0 0 " + width + " " + 135)
			.attr("preserveAspectRatio", "xMinYMin meet")
			.style({
				"position": "relative",
				"top": 0,
				"left": 0,
				"width": "100%",
				"height": "135px"
			})
			.append("g")
				.attr("transform", "translate(0,0)");
	
	// count of chronically absent students
	
	count.append("text")
		.attr("class", "count")
		.attr("x", (width / 2))
		.attr("dy", 60)
		.attr("text-anchor", "middle")
		.attr("fill-opacity", 0)
		.transition()
			.duration(2500)
			.attr("fill-opacity", 1)
			.tween("text", function(d) {
				
				var i = d3.interpolate(0, d.number);
				var j = d3.interpolate(0, d.pct);
				
				return function(t) { this.textContent = formatNumber(i(t)); };
				
			});
	
	count.append("text")
		.attr("class", "countText")
		.attr("x", (width / 2))
		.attr("dy", 100)
		.attr("text-anchor", "middle")
		.attr("fill-opacity", 0)
		.transition()
			.duration(2500)
			.attr("fill-opacity", 1)
			.tween("text", function(d) {
				
				var i = d3.interpolate(0, d.number);
				var j = d3.interpolate(0, d.pct);
				
				return function(t) { this.textContent = "students were chronically absent in 2013-14 (" + formatPercent(j(t)) + ")"; };
				
			});	
	
	// build icon array
	
	var ia = dom.append("div")
		.attr("id", "iaContainer")
		.style({
			"max-width": (rowCount * iconWidth) + "px",
			"margin": "0 auto",
			"display": "block"
		});
	
	d3.xml("Images/chair.svg", "image/svg+xml", function(xml) {  
	
		var importedNode = document.importNode(xml.documentElement, true);
		
		data_ia = data.filter(function(d) { return d.area == "ia"; });
		
		ia.selectAll("div")
			.data(data_ia)
			.enter()
			.append("div")
				.style({
					"display": "inline-block",
				})
				.append("g")
					.each(function() { this.appendChild(importedNode.cloneNode(true)); });
		
		ia.selectAll("svg")
			.attr("width", iconWidth + "px")
			.attr("height", iconHeight + "px");
		
		ia.selectAll("#Woodchair")
			.attr("opacity", 0)
			.attr("class", "icon")
			.transition()
				.delay(function(d, i) { return i * (2500/data_ia.length); })
				.duration(2500)
				.attr("opacity", 1);
		
	});
	
	// add equivalency section
	
	var txt = dom.append("div")
		.data(data_txt)
		.attr("id", "equiSection")
		.style({
			"width": "100%",
			"max-width": width + "px",
			"margin": "0 auto",
			"display": "block"
		})
		.append("svg")
			.attr("viewBox", "0 0 " + width + " " + 175)
			.attr("preserveAspectRatio", "xMinYMin meet")
			.style({
				"position": "relative",
				"top": 0,
				"left": 0,
				"width": "100%",
				"height": "175px"
			})
			.append("g")
				.attr("transform", "translate(0,0)");
	
	txt.append("text")
		.attr("class", "equivText")
		.attr("x", (width / 2))
		.attr("dy", 45)
		.attr("text-anchor", "middle")
		.attr("fill-opacity", 0)
		.text("Cumulatively, across those students, at least")
		.transition()
			.delay(2500)
			.duration(2500)
			.attr("fill-opacity", 1);

	txt.append("text")
		.attr("class", "equiv")
		.attr("x", (width / 2))
		.attr("dy", 115)
		.attr("text-anchor", "middle")
		.attr("fill-opacity", 0)
		.transition()
			.delay(2500)
			.duration(2500)
			.attr("fill-opacity", 1)
			.tween("text", function(d) {
				
				var i = d3.interpolate(0, d.number);
				var j = d3.interpolate(0, d.pct);
				
				return function(t) { this.textContent = formatNumber(i(15 * t)); };
				
			});

	txt.append("text")
		.attr("class", "equivText")
		.attr("x", (width / 2))
		.attr("dy", 155)
		.attr("text-anchor", "middle")
		.attr("fill-opacity", 0)
		.text("school days were missed")
		.transition()
			.delay(2500)
			.duration(2500)
			.attr("fill-opacity", 1);
			
});
			
</script>

</body>

</html>